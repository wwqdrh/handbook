数据库分库分表

> 分库分表之后可能存在的问题: 事务问题(使用分布式事务处理), 跨库关联(读到程序中再进行关联), 排序问题(hash问题才会有排序问题，如果是range不会有), 分页问题, 分布式ID(需要保证分库或者分表之后id不会起冲突)

# 分库

## 垂直分库

按照业务模型进行分库

使用`go-gorm/dbresolver`管理多个数据库连接

## 水平分库

> 事实上不如直接分表，一张表2kw数据，20亿记录往上再考虑分库

使用`go-gorm/dbresolver`管理多个数据库连接

- 按照数据量range进行分库
- 按照某个时间片

# 分表

## 垂直分表

将一张表过长的字段拆分到多个表，其实是由数据库范式决定(列的不可再拆分原子性、非主键字段必须依赖于主键、非主键字段不能够进行传递依赖，当然适当的反范式，通过冗余换取效率(空间换时间))

## 水平分表

> 事实上两层的B+树大约在2kw条记录左右，更多的话B+树的高度就在3层了，会影响sql效率， 这个时候进行分表

使用`go-gorm/sharding`管理分片

- 按照数据量range进行分表
- 按照某个时间片
